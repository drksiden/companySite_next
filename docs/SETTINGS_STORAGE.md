# Хранение настроек в системе

## Текущий подход: База данных

Мы используем таблицу `display_settings` в Supabase для хранения всех настроек системы.

### Преимущества хранения в БД:

1. **Динамическое изменение** - администратор может менять настройки без деплоя
2. **Централизованное хранение** - все настройки в одном месте
3. **Версионирование** - можно добавить историю изменений
4. **Многопользовательский доступ** - несколько админов могут работать с настройками
5. **Аудит** - можно отслеживать кто и когда менял настройки
6. **Кэширование** - React Query кэширует настройки на 5 минут

### Структура хранения:

```sql
display_settings (
  id UUID,
  setting_key TEXT UNIQUE,  -- 'product_display', 'general', 'notifications', etc.
  setting_value JSONB,      -- Настройки в формате JSON
  description TEXT,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
)
```

### Альтернативные подходы:

#### 1. Переменные окружения (.env)
**Когда использовать:**
- Статические настройки, которые не меняются часто
- Секретные данные (API ключи, пароли)
- Настройки окружения (dev/prod)

**Пример:**
```env
NEXT_PUBLIC_SITE_NAME="Мой магазин"
NEXT_PUBLIC_CONTACT_EMAIL="info@example.com"
```

#### 2. Конфигурационные файлы (config.json)
**Когда использовать:**
- Статические настройки приложения
- Настройки по умолчанию
- Локализация

**Недостатки:**
- Требует деплоя для изменения
- Не подходит для многопользовательских систем

#### 3. Комбинированный подход (рекомендуется)
- **БД** - для динамических настроек (отображение, уведомления, оплата)
- **.env** - для секретов и статических настроек
- **config.json** - для дефолтных значений

### Текущая реализация:

1. **Публичный API** (`/api/settings/display`) - для фронтенда (без авторизации)
2. **Админ API** (`/api/admin/settings/*`) - для управления (требует авторизации)
3. **React Query хук** (`useDisplaySettings`) - для использования в компонентах
4. **Кэширование** - 5 минут stale time, 10 минут cache time

### Рекомендации:

✅ **Используйте БД для:**
- Настроек отображения товаров
- Настроек уведомлений
- Настроек оплаты/доставки
- Любых настроек, которые могут меняться администратором

✅ **Используйте .env для:**
- API ключей
- Секретов
- URL внешних сервисов
- Настроек окружения

✅ **Используйте config.json для:**
- Дефолтных значений
- Констант приложения
- Локализации

### Производительность:

- Настройки кэшируются через React Query
- Запрос к БД выполняется один раз при загрузке страницы
- При изменении настроек кэш автоматически инвалидируется
- Можно добавить Redis для кэширования на сервере

